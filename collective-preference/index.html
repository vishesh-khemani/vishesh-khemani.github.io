<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Collective Preference</title>
    <script src="https://unpkg.com/mathjs@9.0.0/lib/browser/math.js"></script>
    <script src="collective-preference.js"></script>
    <script src="https://github.com/mdaines/viz.js/releases/download/v2.1.2/viz.js"></script>
    <script src="https://github.com/mdaines/viz.js/releases/download/v2.1.2/full.render.js"></script>
  </head>
  <body>
    <form id="form">
      Options (newline-separated):<br>
      <textarea rows="5" cols="80" id="options" name="options">
A
B
C
      </textarea>
      <br><br>
      Votes (newline-separated, each vote comma-separated in decreasing preference order):<br>
      <textarea id="votes" name="votes" rows="5" cols="80">
A, B, C
A, C, B
B, A, C
      </textarea>
      <br><br>
      <input type="submit" value="Compute">
      <br><br>
    </form>
    <div id="result"></div>

    <script>
    let form = document.getElementById('form');
    form.onsubmit = () => {
      event.preventDefault();
      let options = document.getElementsByName("options")[0].value.split(/\r|\n/);
      let votes = document.getElementsByName("votes")[0].value.split(/\r|\n/);
      let collectivePreference = new CollectivePreference(options);
      for (let vote of votes) {
        vote = vote.split(",");
        collectivePreference.addVote(...vote);
      }
      let preference = collectivePreference.getPreference(1e-3);
      let list = document.createElement("ul");
      for (let i = 0; i < collectivePreference.getItems().length; ++i) {
        let item = list.appendChild(document.createElement("li"));
        let percent = parseFloat(preference.subset(math.index(i, 0))) * 100;
        let textNode = document.createTextNode(
          `${collectivePreference.getItems()[i]}: ${percent.toFixed(1)}\%`);
        item.appendChild(textNode);
      }
      let result = document.getElementById("result");
      result.innerHTML = "";
      result.appendChild(
        document.createTextNode("Collective Preference (based on "
          + `${collectivePreference.getNumVotes()} votes):`));
      result.appendChild(document.createElement("br"));
      result.appendChild(list);

      let viz = new Viz();
      viz.renderSVGElement(
          collectivePreference.getVotesDigraph())
            .then(element => {
              result.appendChild(element);
              result.appendChild(document.createElement("hr"));
            })
            .catch(error => console.error(error));
    }
    </script>
  </body>
</html>
